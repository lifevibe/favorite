<body class="io-grey-mode">
    {{ if $.Site.Params.enablePreLoad }}
    <div id="loading">
        <style>
            .loader {
                width: 250px;
                height: 50px;
                line-height: 50px;
                text-align: center;
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                font-family: helvetica, arial, sans-serif;
                text-transform: uppercase;
                font-weight: 900;
                color: #f1404b;
                letter-spacing: 0.2em
            }

            .loader::before,
            .loader::after {
                content: "";
                display: block;
                width: 15px;
                height: 15px;
                background: #f1404b;
                position: absolute;
                animation: load .7s infinite alternate ease-in-out
            }

            .loader::before {
                top: 0
            }

            .loader::after {
                bottom: 0
            }

            @keyframes load {
                0% {
                    left: 0;
                    height: 30px;
                    width: 15px
                }

                50% {
                    height: 8px;
                    width: 40px
                }

                100% {
                    left: 235px;
                    height: 30px;
                    width: 15px
                }
            }
        </style>
        <div class="loader">{{ $.Site.Params.textPreLoad }}</div>
    </div>
    {{ end }}
    <div class="page-container">
    {{ if $.Site.Params.expandSidebar }}
    <div id="sidebar" class="sticky sidebar-nav fade animate-nav" style="width: 170px">
        {{ else }}
        <div id="sidebar" class="sticky sidebar-nav fade mini-sidebar" style="width: 60px;">
    {{ end }}
            <div class="modal-dialog h-100 sidebar-nav-inner">
                <div class="sidebar-logo border-bottom border-color">
                    <!-- logo -->
                    <div class="logo overflow-hidden">
                        <a href="" class="logo-expanded">
                            {{ define "logo-svg-path" }}
                                <path d="M10.88 124.032H0L12.672 4.224h68.224q4.736 0 7.36 2.496a7.44 7.44 0 0 1 2.196 5.656 13 13 0 0 1-.084 1.448l-9.472 89.728a36.7 36.7 0 0 1-1.977 9.295 20 20 0 0 1-1.543 3.249q-2.752 4.608-6.72 6.464t-8.448 1.856q-6.272 0-10.944-4.288a20.24 20.24 0 0 1-5.84-10.897 32 32 0 0 1-.24-1.199l8.96-2.304a13.4 13.4 0 0 0 2.652 6.023 6.51 6.51 0 0 0 5.156 2.297q3.584 0 5.568-3.008a15.2 15.2 0 0 0 1.801-4.695 53 53 0 0 0 1.079-6.633V99.2l-7.552 2.56q-.896-5.632-1.856-11.072T58.88 80q-5.248 13.056-12.032 24.576l-8.576-4.352q3.968-6.144 7.296-13.056L38.4 90.752q-1.536-8.192-3.456-16.128-3.072 7.936-6.528 15.168t-7.424 13.888l-7.424-4.48zm155.136-15.744h18.816l-1.28 11.264h-62.72l1.28-11.264h12.544l8.832-84.224h10.624l-8.832 84.224h9.984L166.912.128h10.752l-4.608 42.24h14.848l-1.28 11.776h-14.848zM65.536 20.864l8.96 1.92a354 354 0 0 1-5.054 24.165 263 263 0 0 1-5.058 17.819Q66.176 72.192 67.84 80t2.944 15.872l8.576-81.28H22.4l-8.576 81.28q4.992-8.448 9.216-17.728t7.68-20.032q-2.048-7.168-4.288-13.888t-4.544-12.992l7.808-4.992q2.944 7.168 5.632 15.616 2.56-10.24 4.608-21.888l8.96 2.048Q48 27.52 46.848 32.768l6.656-3.712q3.2 8.448 6.272 18.688 1.664-6.4 3.072-13.056t2.688-13.824m251.776 84.864 8.064-1.28a68 68 0 0 0 .649 6.386l.055.334a4.3 4.3 0 0 0 .942 2.475.64.64 0 0 0 .402.149q1.152 0 1.792-2.56t1.28-8.704l.768-7.424-6.912 2.176q-.512-4.608-1.472-9.728t-2.24-10.24a298 298 0 0 1-3.676 19.002 222 222 0 0 1-1.636 6.662 328 328 0 0 1-5.921 20.074l-.415 1.238-9.6-4.736a226 226 0 0 0 4.104-12.883 352 352 0 0 0 2.808-10.349q3.456-13.504 6.016-29.376h-3.84l1.152-10.368h4.224q.256-1.408.384-2.944l4.608-37.888h8.192q1.664-3.968 3.008-7.808t2.368-7.808l9.984 1.92q-1.024 3.456-2.112 6.848t-2.496 6.848h2.304q4.096 0 6.528 2.816a8.6 8.6 0 0 1 2.1 5.819 12 12 0 0 1-.052 1.093l-8.576 81.152a42.5 42.5 0 0 1-1.718 8.717 19.6 19.6 0 0 1-1.93 4.275q-2.752 4.416-8.384 4.416-4.352 0-7.36-3.904t-3.392-14.4m30.336 18.304-9.216-5.76q3.328-6.016 5.76-13.312t4.288-16.896 3.392-22.656l2.944-25.216h20.096a10.64 10.64 0 0 1 6.023 1.492q3.655 2.465 2.937 9.004l-5.632 52.864a40 40 0 0 0-.315 4.605 16 16 0 0 0 .123 2.115q.32 2.368 1.856 2.368 1.792 0 3.2-4.48t3.328-13.44l8.448 2.304a140 140 0 0 1-2.117 10.039 66 66 0 0 1-1.787 5.961 25 25 0 0 1-3.35 6.603 11.6 11.6 0 0 1-1.642 1.781q-2.88 2.496-7.104 2.496-6.272 0-9.088-5.312a19.8 19.8 0 0 1-2.061-7.934q-.203-2.901.141-6.338l5.632-53.504h-9.6l-1.664 14.976q-2.048 18.944-5.312 32.96t-9.28 25.28m-86.528-60.16h11.52l-.896 7.936h18.56l-1.152 11.008h-18.56l-1.92 18.304q-1.152 10.752-6.464 16.896t-14.784 6.144q-8.832 0-13.632-4.352t-6.976-11.264l10.112-3.072q1.28 3.968 3.584 5.888t6.4 1.92q4.736 0 7.168-3.008t3.2-10.432l1.792-17.024h-27.264q1.792 3.584 3.392 7.296t3.008 7.424l-9.856 3.84q-1.664-4.352-3.776-9.152t-4.544-9.408h-14.464l1.28-11.008h53.376zm-45.056-27.904 3.456-31.744h53.12q5.248 0 8 2.624a7.66 7.66 0 0 1 2.233 5.817 14 14 0 0 1-.121 1.799l-2.176 21.76h-53.12a19 19 0 0 0-.047 1.304A9.24 9.24 0 0 0 232 46.336a20.5 20.5 0 0 0 6.301 2.021q3.62.646 8.563.767a96 96 0 0 0 2.352.028 107 107 0 0 0 17.194-1.289 80 80 0 0 0 4.31-.823q9.6-2.112 17.536-6.848l4.864 10.496q-4.608 2.688-10.624 4.864a68.5 68.5 0 0 1-11.297 2.902 103 103 0 0 1-3.039.49q-8.32 1.216-19.968 1.216-10.752 0-18.304-2.176a20.47 20.47 0 0 1-10.162-6.084 16 16 0 0 1-1.038-1.34 17 17 0 0 1-2.764-8.5q-.222-2.79.14-6.092m-113.408 77.568-4.352-11.008q6.144-2.304 11.776-4.864l5.504-52.352h-9.472l1.152-10.88h9.472l3.328-32.512h10.88l-3.456 32.512h9.216l-1.152 10.88h-9.216l-4.864 46.976q4.48-2.304 8.448-4.736l5.12 10.112q-7.68 4.48-15.872 8.384t-16.512 7.488m274.176-97.92h18.688l-1.152 10.88h-43.264l1.152-10.88h13.824L367.744 0h10.752zM40.32 58.88q1.664 6.272 3.2 12.928t2.944 13.568q4.864-9.984 8.704-21.632-2.048-7.808-4.224-15.04t-4.48-14.016q-2.688 12.8-6.144 24.192m189.44-43.904-1.152 10.496h41.6l1.024-10.496zm91.264 59.776 6.4-2.176q1.408 4.736 2.432 9.664t1.792 9.92l2.56-25.216h-11.904q-.64 3.968-1.28 7.808M336 49.92l-6.4 1.92q-.64-3.712-1.408-7.808t-1.92-8.32l-2.688 20.864h11.776zm-9.472-16.768 6.016-2.048q2.688 8.192 3.712 16.384l2.176-21.12h-11.008z"/>
                            {{ end }}
                            <img src="{{ relURL $.Site.Params.images.logoExpandLight }}" height="40" class="logo-light" alt="{{ .Site.Title }}">
                                <svg width="4.5rem" height="2rem" class="logo-light" viewBox="0 0 395.52 124.417" xmlns="http://www.w3.org/2000/svg"><g id="svgGroup" stroke-linecap="round" fill-rule="evenodd" font-size="9pt" stroke="#282a2d" stroke-width="0.25mm" fill="#282a2d" style="stroke:#282a2d;stroke-width:0.25mm;fill:#282a2d">
                                    {{ template "logo-svg-path" }}
                                </g></svg>
                            <img src="{{ relURL $.Site.Params.images.logoExpandDark }}" height="40" class="logo-dark d-none" alt="{{ .Site.Title }}">
                                <svg width="4.5rem" class="logo-dark d-none" height="2rem" viewBox="0 0 395.52 124.417" xmlns="http://www.w3.org/2000/svg"><g id="svgGroup" stroke-linecap="round" fill-rule="evenodd" font-size="9pt" stroke="#c6c9cf" stroke-width="0.25mm" fill="#c6c9cf" style="stroke:#c6c9cf;stroke-width:0.25mm;fill:#c6c9cf">
                                    {{ template "logo-svg-path" }}
                                </g></svg>
                        </a>
                        <a href="" class="logo-collapsed">
                            <img src="{{ relURL $.Site.Params.images.logoCollapseLight }}" height="40" class="logo-light"
                                alt="{{ .Site.Title }}">
                            <img src="{{ relURL $.Site.Params.images.logoCollapseDark }}" height="40" class="logo-dark d-none"
                                alt="{{ .Site.Title }}">
                        </a>
                    </div>
                    <!-- logo end -->
                </div>

                <div class="sidebar-menu flex-fill">
                    <div class="sidebar-scroll">
                        <div class="sidebar-menu-inner">
                            <ul>
                                {{/* 读取并解析 webstack.json 数据 */}}
                                {{ $webstackResource := resources.Get "data/webstack.json" }}
                                {{ $sites := $webstackResource | transform.Unmarshal }}

                                {{/* 按分类组织数据 */}}
                                {{ $categories := dict }}
                                {{ $subCategories := dict }}
                                
                                {{ range $site := $sites }}
                                    {{ range $categoryInfo := $site.WebCategories }}
                                        {{ $cat := $categoryInfo.WebCategory_id }}
                                        
                                        {{ if $cat.toplevel }}
                                            {{ $existing := index $categories $cat.name }}
                                            {{ if not $existing }}
                                                {{ $categories = merge $categories (dict $cat.name (dict "info" $cat "sites" (slice))) }}
                                            {{ end }}
                                        {{ else }}
                                            {{ $existing := index $subCategories $cat.name }}
                                            {{ if not $existing }}
                                                {{ $subCategories = merge $subCategories (dict $cat.name (dict "info" $cat "sites" (slice))) }}
                                            {{ end }}
                                        {{ end }}
                                    {{ end }}
                                {{ end }}
                                
                                {{/* 将站点分配到对应分类 */}}
                                {{ range $site := $sites }}
                                    {{ range $categoryInfo := $site.WebCategories }}
                                        {{ $cat := $categoryInfo.WebCategory_id }}
                                        
                                        {{ if $cat.toplevel }}
                                            {{ $catData := index $categories $cat.name }}
                                            {{ $updatedSites := $catData.sites | append $site }}
                                            {{ $updatedCatData := merge $catData (dict "sites" $updatedSites) }}
                                            {{ $categories = merge $categories (dict $cat.name $updatedCatData) }}
                                        {{ else }}
                                            {{ $catData := index $subCategories $cat.name }}
                                            {{ $updatedSites := $catData.sites | append $site }}
                                            {{ $updatedCatData := merge $catData (dict "sites" $updatedSites) }}
                                            {{ $subCategories = merge $subCategories (dict $cat.name $updatedCatData) }}
                                        {{ end }}
                                    {{ end }}
                                {{ end }}
                                
                                {{/* 按权重排序顶级分类 */}}
                                {{ $sortedCategories := slice }}
                                {{ range $name, $data := $categories }}
                                    {{ $sortedCategories = $sortedCategories | append (merge $data (dict "name" $name)) }}
                                {{ end }}
                                {{ $sortedCategories = sort $sortedCategories "info.weight" }}

                                {{/* 收集所有需要显示的父级分类，并带上它们的图标信息 */}}
                                {{ $fatherCategories := dict }}

                                {{/* 收集所有顶级分类 */}}
                                {{ range $name, $data := $categories }}
                                    {{ if $data.sites }}
                                        {{ $fatherCategories = merge $fatherCategories (dict $name (merge $data.info (dict "name" $name "has_sub" false))) }}
                                    {{ end }}
                                {{ end }}

                                {{/* 收集所有有子分类的父级分类，并把子分类的 father_icon 赋给父级 */}}
                                {{ range $subName, $subData := $subCategories }}
                                    {{ $fatherName := $subData.info.father }}
                                    {{ $fatherInfo := index $categories $fatherName }}
                                    
                                    {{/* 检查父级是否已存在，如果不存在，创建一个虚拟父级 */}}
                                    {{ $existing := index $fatherCategories $fatherName }}
                                    {{ if not $existing }}
                                        {{ $fatherCategories = merge $fatherCategories (dict $fatherName (dict "name" $fatherName "weight" 999 "toplevel" true "has_sub" true)) }}
                                    {{ end }}

                                    {{/* 将子分类的 father_icon 赋值给父级分类 */}}
                                    {{ if $subData.info.father_icon }}
                                        {{ $currentFather := index $fatherCategories $fatherName }}
                                        {{ $updatedFather := merge $currentFather (dict "father_icon" $subData.info.father_icon "has_sub" true) }}
                                        {{ $fatherCategories = merge $fatherCategories (dict $fatherName $updatedFather) }}
                                    {{ end }}
                                {{ end }}

                                {{/* 按权重排序父级分类 */}}
                                {{ $sortedFatherCategories := slice }}
                                {{ range $name, $info := $fatherCategories }}
                                    {{ $sortedFatherCategories = $sortedFatherCategories | append (dict "name" $name "info" $info) }}
                                {{ end }}
                                {{ $sortedFatherCategories = sort $sortedFatherCategories "info.weight" }}

                                {{/* 渲染所有父级分类及其子分类 */}}
                                {{ range $fatherCategory := $sortedFatherCategories }}
                                    <li class="sidebar-item">
                                        <a href="#{{ $fatherCategory.name | md5 }}" class="smooth">
                                            {{ if $fatherCategory.info.has_sub }}
                                                {{/* 有子分类时，优先使用父级的 father_icon */}}
                                                {{ if $fatherCategory.info.father_icon }}
                                                    {{ $fatherCategory.info.father_icon | safeHTML }}
                                                {{ else }}
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="1rem" height="1rem" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="2"><path d="M4 6h16v2H4zm0 5h16v2H4zm0 5h16v2H4z"/></g></svg>
                                                {{ end }}
                                            {{ else }}
                                                {{/* 没有子分类时，使用父级的 icon */}}
                                                {{ if $fatherCategory.info.icon }}
                                                    {{ $fatherCategory.info.icon | safeHTML }}
                                                {{ else }}
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="1rem" height="1rem" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="2"><path d="M4 6h16v2H4zm0 5h16v2H4zm0 5h16v2H4z"/></g></svg>
                                                {{ end }}
                                            {{ end }}
                                            <span>{{ $fatherCategory.name }}</span>
                                            {{ if $fatherCategory.info.has_sub }}
                                                <span class="sidebar-more"><svg xmlns="http://www.w3.org/2000/svg" width="1rem" height="1rem" viewBox="0 0 24 24"><g fill="none" fill-rule="evenodd"><path d="M24 0v24H0V0zM12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035q-.016-.005-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093q.019.005.029-.008l.004-.014l-.034-.614q-.005-.019-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M15.707 11.293a1 1 0 0 1 0 1.414l-5.657 5.657a1 1 0 1 1-1.414-1.414l4.95-4.95l-4.95-4.95a1 1 0 0 1 1.414-1.414z"/></g></svg></span>
                                            {{ end }}
                                        </a>
                                        
                                        {{ if $fatherCategory.info.has_sub }}
                                            <ul>
                                                {{/* 查找该父级分类下的所有子分类并按权重排序 */}}
                                                {{ $sortedSubCategories := slice }}
                                                {{ range $subName, $subData := $subCategories }}
                                                    {{ if eq $subData.info.father $fatherCategory.name }}
                                                        {{ $sortedSubCategories = $sortedSubCategories | append $subData }}
                                                    {{ end }}
                                                {{ end }}
                                                {{ $sortedSubCategories = sort $sortedSubCategories "info.weight" }}
                                                
                                                {{ range $subData := $sortedSubCategories }}
                                                    <li>
                                                        <a href="#{{ $subData.info.name | md5 }}" class="smooth">
                                                            {{ if $subData.info.icon }}
                                                                {{ $subData.info.icon | safeHTML }}
                                                            {{ else }}
                                                                <svg xmlns="http://www.w3.org/2000/svg" width="1rem" height="1rem" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="2"><path d="M8 6h8v2H8zm0 5h8v2H8zm0 5h5v2H8z"/></g></svg>
                                                            {{ end }}
                                                            <span>{{ $subData.info.name }}</span>
                                                        </a>
                                                    </li>
                                                {{ end }}
                                            </ul>
                                        {{ end }}
                                    </li>
                                {{ end }}

                            </ul>
                        </div>
                    </div>
                </div>

                <div class="border-top py-2 border-color">
                    <div class="flex-bottom">
                        <ul>
                            {{ range .Site.Data.sidebars }}
                            <li {{ if .list }}class="menu-item-has-children" {{ end }}>
                                <a href="{{ .link }}" {{ if .target }}target="{{ .target }}"{{ end }}>
                                    {{ .icon | safeHTML }}
                                    <span class="{{ if .target }}menu-item-link-external{{ else }}menu-item-link-internal{{ end }}">{{ .item | safeHTML }}</span>
                                </a>
                                <!-- 导航栏下拉菜单实现添加图标 -->
                                <ul class="sub-menu">
                                    {{ range .list }}
                                    <li {{ if .list }}class="menu-item-has-children" {{ end }}>
                                        <a href="{{ .link }}" {{ if .target }}target="{{ .target }}"{{ end }}>
                                            {{ .icon | safeHTML }}
                                            <span>{{ .name | safeHTML }}</span>
                                        </a>
                                    </li>
                                    {{ end }}
                                </ul>
                            </li>
                            {{ end }}
                        </ul>
                    </div>
                </div>
            </div>
        </div>
